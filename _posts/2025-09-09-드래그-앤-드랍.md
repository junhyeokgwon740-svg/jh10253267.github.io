---
layout: post
title:  "드래그 앤 드랍"
author: 악어새62
categories: [ TIL, Backend ]
image: assets/images/1.jpg
tags: []
---
## 개요

드래그 앤 드랍으로 UX를 향상시킬 수 있다. 한번 알아보자.

## 핵심

가장 핵심의 속성은  draggable="true"이다.  
이 속성이 선언된 요소는 드래그 할 수 있다.

그런 다음 드래그 상태와 관련된 이벤트들을 알아야한다.

```js

const item = document.querySelector('.item');

item.addEventListner('dragstart', () => {
    console.log('dragstart event);
});

```
그 다음으론 drag이벤트가 있다. 해당 요소를 드래그해서 움직이는 동안에 발생하는 이벤트다.

```js
const item = document.querySelector('.item');

item.addEventListner('drag', () => {
    console.log('drag event);
});

```
dragenter는 대상 객체로 처음 진입할 때 발생하는 이벤트다.

```js
const container = document.querySelector('#container');

container.addEventListner('dragenter', () => {
    console.log('dragenter event);
});

```
다음으론 dragover이벤트로 대상 객체의 위에 존재할 때 발생하는 이벤트다.

```js
const container = document.querySelector('#container');

container.addEventListner('dragover', () => {
    console.log('dragenter event);
});
```

## 백엔드 관점에서의  드래그 앤 드랍

이제 생각해 볼 것은백엔드에서의 처리다.  
옮긴 상태가 저장이되어야하는데 어떻게 저장하고 어떻게 불러올 수 있을까?

우선 양 끝단인 데이터베이스와 API 조회만 놓고 생각을 해보자.

API조회시 리턴된 순서대로 렌더링을 할 것이다.  
데이터베이스에서는 위의 순서를 ORDER BY절을 사용해서 정렬해 줄 것이다.  
그러려면 order혹은 sequence와 같은 순서를 저장하는 컬럼이 있어야할 것이다.  
그럼 order by sequnece asc 쿼리를 날리면 순서대로 불러올 수 있다.  


그러나 아직 고민거리는 남았는데 만약에 요소를 끌어다가 A B 요소 사이에 넣는다면 순서를 어떻게 기록해야할까?
가장 단순한 방법으로는 해당 번호 이후의 시퀀스 값을 update처리하는 것이다.  
만약 요소를 가장 첫번째에 놓는다면 이 이후의 100개면 99개 1000개면 999개 행에 대해 update쿼리가 나간다.  
뭐 나쁜 방법은 아니지만 데이터가 많아지면 분명 문제가 생길 것이다. 다른 방법은 없을까?

여기에는 update를 한 건만 날려 순서를 갱신할 수 있는 한 가지 해결책이 있다. 바로 중간 값으로 갱신하는 것이다.

예를 들어 첫번째 순서를 1 두 번째 순서를 100이라고 했을 때 만약 이 A B사이에 요소를 넣는다면 순서는 50이 된다.  
그럼 데이터베이스에서 ORDER BY SEQUENCE ASC로 가져오면 1, 50, 100 순으로 불러와진다.  

그러나... 이진탐색처럼 범위를 좁혀가니 간격을 10000으로 한다고 해도 log2 2^13이니 13번까지만 순서를 변경할 수 있다.
